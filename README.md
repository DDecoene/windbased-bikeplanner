# Windbased Bikeplanner 🚴‍♂️🌬️

**Repository:** [https://github.com/DDecoene/windbased-bikeplanner](https://github.com/DDecoene/windbased-bikeplanner)  
**Status:** ⚠️ Under Heavy Development ⚠️

A smart cycling route planner for Flanders, Belgium that generates optimal loop routes based on current wind conditions and the regional cycling node network (fietsknooppunten).

---

## ‼️ Current Development Status

**This project is currently undergoing a major refactoring. The main application (`app.py`) is broken and will not run correctly.**

The core of the development work is focused on `graph_loader.py`, which is responsible for constructing a usable network graph from the raw database. This is a complex task, and we are working to make it robust against gaps and errors in the OpenStreetMap data.

Because the main application depends entirely on a functioning graph loader, other modules like `routing.py` and the `app.py` interface are currently non-functional.

## ✅ Working Components

While the main user-facing application is down, several key components and command-line tools are stable and working as intended.

### Core Services
*   `weather.py`: This module correctly fetches and formats real-time wind data from the Open-Meteo API.

### Data & Debugging Tools
These scripts are essential for the ongoing development and for diagnosing issues with the network data.

*   **`build_database.py`**
    *   **Purpose:** Connects to the Overpass API to download cycling network data for a specified region and saves it into a local SQLite database (`fietsnetwerk_default.db`). This is the first step.
    *   **Usage:** `python build_database.py`

*   **`visualize_db.py`**
    *   **Purpose:** Generates a full, interactive map (`visualisatie_explorer.html`) of all the data in the database. It's useful for getting a high-level overview of the downloaded network.
    *   **Usage:** `python visualize_db.py`

*   **`debug_local_graph.py`**
    *   **Purpose:** A powerful diagnostic tool to visualize why graph construction is failing in a specific area. It creates a map (`debug_diagnostic_map.html`) that colors paths green (successful) or red (broken), helping to pinpoint problematic data.
    *   **Usage:** `python debug_local_graph.py`

*   **`extract_relation_data.py`**
    *   **Purpose:** If you find a broken relation ID using the debug map, this tool prints a detailed, human-readable report of all the ways and nodes that make up that single relation, which is crucial for deep analysis.
    *   **Usage:** `python extract_relation_data.py <RELATION_ID>`

---

## Setup for Developers

1.  **Clone the repository:**
    ```bash
    git clone https://github.com/DDecoene/windbased-bikeplanner.git
    cd windbased-bikeplanner
    ```

2.  **Install required packages:**
    (It is recommended to use a virtual environment)
    ```bash
    pip install -r requirements.txt
    ```

3.  **Build the local cycling network database:**
    This script downloads the latest raw cycling network data from OpenStreetMap.
    ```bash
    python build_database.py
    ```
    This will create a `fietsnetwerk_default.db` file.

4.  **Use the diagnostic tools** to explore the data and contribute to fixing the `graph_loader.py` module.

---

## How It's *Supposed* to Work (Future State)

Once development is complete, the application will:
1.  Take a user's start location and desired loop distance.
2.  Fetch live wind data for that location using `weather.py`.
3.  Use the robust `graph_loader.py` to build a local network graph.
4.  Calculate a route that minimizes effort against the wind, matches the desired distance, and uses the cycling node network for navigation.
5.  Display the final route and junctions on an interactive map in the Streamlit app.

---

## Project Structure

Here is the current status of the key files in the project:

windbased-bikeplanner/
├── 📝 README.md # This file
├── 📝 requirements.txt # Python dependencies
├── 📝 overpass_query.txt # The Overpass query used to fetch data
│
├── 🟢 app.py # (BROKEN) Main Streamlit application
│
├── ✅ build_database.py # (WORKING) Script to download raw OSM data
├── ✅ visualize_db.py # (WORKING) Utility to visualize all relations
├── ✅ debug_local_graph.py # (WORKING) Utility to diagnose broken relations
├── ✅ extract_relation_data.py # (WORKING) CLI tool for detailed relation reports
│
├── 🟡 graph_loader.py # (IN DEV) Core module being actively fixed
├── 🟡 routing.py # (IN DEV) Depends on graph_loader
├── 🟡 effort_calculator.py # (IN DEV) Depends on graph_loader
├── ✅ weather.py # (WORKING) Module for fetching weather data
│
└── 🗃️ fietsnetwerk_default.db # The SQLite database (generated by build_database.py)


---

## Roadmap

-   **Immediate Goal:** Fix `graph_loader.py` to robustly handle broken or incomplete data from OSM.
-   **Future Goals:**
    -   [ ] Support for other regions (e.g., Wallonia, Netherlands).
    -   [ ] Integrate elevation data for an even more accurate "effort" score.
    -   [ ] Add GPX export functionality for the generated routes.

## License

This project is open source and available under the MIT License.

## Acknowledgments

-   **OpenStreetMap** contributors for the invaluable cycling network data.
-   **Open-Meteo** for providing a free and powerful weather API.
-   **Streamlit** for making web app development in Python so accessible.

---

**Happy cycling! 🚴‍♂️**

*Made with ❤️ for the cycling community in Flanders*